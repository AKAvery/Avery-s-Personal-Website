<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/IndividualProjects/fistbump.css') }}">
    <title>Fistbump</title>
</head>
<body>
    <div> 
        <header class="header">
            <a href="/" class="nav-text">Home</a>
            <nav class="nav-bar">
                <a href="/about" class="nav-text">About Me</a>
                <a href="/projects" class="nav-text">Projects</a>
            </nav>
        </header>
        <main id="infinite-content">
            <div style="margin-top: 50px; text-align: center;">
                <img class="img-background" src="{{ url_for('static', filename='images/fistbumpHome.jpeg') }}" alt="fistbump home page">
            </div>

            <div class="selector-content">
                <div class="page-row-section">
                    <div style="margin-top: 100px; margin-bottom: 100px; margin-left: 350px; margin-right: 350px;">
                        <p1 class="page-text"> Fistbump is a social networking app that links you with other users. Each day, you recieve 1 random user, with whom you must meet up with in person, and take a picture with them. After this, your image is shared to the wall, where everyone can see connections being made with their friends. This short act of meeting up to take your Fistbump together finishes the hardest step of meeting new people: Breaking the ice. After meeting each other, the two users are physically close and have talked, and this small connection could lead to more conversations, activities done together, shared phone numbers, and eventually, a new friendship.</p1>
                    </div>
                </div>
            </div>
            <div class="selector-content">
                <div class="page-row-section" style="margin-bottom: 100px;">
                    <img style="margin-right: 100px;" class="img-vertical" src="{{ url_for('static', filename='images/fistbumpProfile.jpeg') }}" alt="fistbump profile page">
                    <img style="margin-left: 100px;" class="img-vertical" src="{{ url_for('static', filename='images/fistbumpPhoto.jpeg') }}" alt="fistbump picture page">
                </div>
            </div>
        </main>
    </div>

    <div id="buffer-zone" class="page-column-section">
        <div class="slow-container" id="slow-scroll"></div>
        <img style="position: absolute" src="{{ url_for('static', filename='images/arrow_down.png') }}">
    </div>
    <div id="loading" style="display: none;">Loading...</div>

    <script>
        function checkVisibility() {
            var elements = document.querySelectorAll('.selector-content');
            elements.forEach(function(footerEl) {
                const rect = footerEl.getBoundingClientRect();
                if (rect.bottom <= (window.innerHeight + 150)) {
                    footerEl.classList.add('visible-selector-content');
                }
            });
        }
        window.addEventListener('scroll', checkVisibility);
        window.addEventListener('resize', checkVisibility);
        document.addEventListener('DOMContentLoaded', checkVisibility);
    
        document.addEventListener('DOMContentLoaded', () => {
            const pages = [
                '/fistbump',
                '/stockSentiment'
            ];
            let currentPageIndex = 0;
            let loading = false;
            let bufferReached = false;
            let scrollCount = 0;
            let lastScrollTime = 0;
            let scrollFactor = 1;

            const loadMoreContent = () => {
                if (loading || scrollCount < 2) return;
                loading = true;
                document.getElementById('loading').style.display = 'block';

                currentPageIndex = (currentPageIndex + 1) % pages.length;
                fetch(pages[currentPageIndex])
                    .then(response => response.text())
                    .then(data => {
                        const parser = new DOMParser();
                        const newDocument = parser.parseFromString(data, 'text/html');
                        const newContent = newDocument.getElementById('infinite-content').innerHTML;
                        const newContentContainer = document.createElement('div');
                        newContentContainer.innerHTML = newContent;
                        document.getElementById('infinite-content').appendChild(newContentContainer);
                        document.getElementById('loading').style.display = 'none';
                        loading = false;
                        bufferReached = false;
                        scrollCount = 0;

                        window.scrollTo({ top: newContentContainer.offsetTop, behavior: 'smooth' });
                    })
                    .catch(() => {
                        document.getElementById('loading').style.display = 'none';
                        loading = false;
                        bufferReached = false;
                    });
            };

            const bufferZone = document.getElementById('buffer-zone');
            const slowScrollContainer = document.getElementById('slow-scroll');


            window.addEventListener('scroll', () => {
                const now = Date.now();
                if (now - lastScrollTime < 200) return;
                lastScrollTime = now;

                const rect = bufferZone.getBoundingClientRect();
                if ((rect.bottom - 100) <= window.innerHeight && !bufferReached) {
                    bufferReached = true;
                    scrollCount = 0;
                }
            });

            window.addEventListener('wheel', (event) => {

                const slowScrollRect = slowScrollContainer.getBoundingClientRect();
                if (slowScrollRect.top <= window.innerHeight && slowScrollRect.bottom >= window.innerHeight) {
                    event.preventDefault();
                    window.scrollBy({
                        top: event.deltaY * scrollFactor,
                        behavior: 'smooth'
                    });
                }

                if (bufferReached && event.deltaY > 0) { 
                    scrollCount++;
                    if (scrollCount >= 2 && !loading) {
                        loadMoreContent();
                    }
                }
            });

            window.addEventListener('touchmove', () => {
                if (bufferReached) {
                    scrollCount++;
                    if (scrollCount >= 2 && !loading) {
                        loadMoreContent();
                    }
                }
            });
        });

    </script>
    
    
</body>
</html>